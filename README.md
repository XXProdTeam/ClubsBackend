## Оглавление
- [Необходимые компоненты](#необходимые-компоненты)
- [Конфигурация](#конфигурация)
- [Настройка локального окружения (без Docker)](#настройка-локального-окружения-без-docker)
- [Запуск (с использованием Docker)](#запуск-с-использованием-docker)
  - [Локальный запуск для разработки](#локальный-запуск-для-разработки)
  - [Запуск в продакшене](#запуск-в-продакшене)
- [Доступные команды Makefile](#доступные-команды-makefile)

## Необходимые компоненты
Для работы с проектом вам понадобятся:
- [Python 3.12+](https://www.python.org/)
- [Docker](https://www.docker.com/get-started) (для запуска в контейнерах)
- [Docker Compose](https://docs.docker.com/compose/install/) (для запуска в контейнерах)

## Конфигурация
Для корректной работы приложения необходимо создать файл `.env` в корневой директории проекта. Этот файл должен содержать следующие переменные окружения:

```
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DB=your_postgres_db
POSTGRES_HOST=your_postgres_host
POSTGRES_PORT=your_postgres_port

BOT_TOKEN=your_bot_token
```

Замените `your_postgres_user`, `your_postgres_password`, `your_postgres_db`, `your_postgres_host`, `your_postgres_port`, `your_bot_token` на ваши значения.

## Настройка локального окружения (без Docker)

1.  **Установите `uv`**
    Проект использует `uv` для управления зависимостями и виртуальным окружением. Установите его с помощью `pip`:
    ```bash
    pip install uv
    ```

2.  **Создайте и активируйте виртуальное окружение**
    В корневой директории проекта выполните команду для создания виртуального окружения:
    ```bash
    uv venv
    ```
    Эта команда создаст папку `.venv`. Теперь активируйте его:

    *   **Для macOS/Linux:**
        ```bash
        source .venv/bin/activate
        ```
    *   **Для Windows:**
        ```bash
        .venv\Scripts\activate
        ```

3.  **Установите зависимости**
    После активации окружения установите все зависимости, указанные в `pyproject.toml` и `uv.lock`:
    ```bash
    uv sync
    ```

## Запуск (с использованием Docker)
Проект можно запустить в двух режимах: для локальной разработки и для продакшена.

### Локальный запуск для разработки
Этот режим запускает основные сервисы: `app`, `bot` и `db`.

1.  **Сборка и запуск контейнеров:**
    Для сборки и запуска контейнеров в фоновом режиме выполните следующую команду в терминале:

    ```bash
    make up-dev
    ```
    Эта команда использует файл `docker-compose.yml` для сборки и запуска необходимых сервисов.

2.  **Проверка состояния:**
    Вы можете проверить состояние запущенных контейнеров с помощью команды:
    ```bash
    docker ps
    ```3.  **Остановка контейнеров:**
    Чтобы остановить все запущенные контейнеры, используйте команду:
    ```bash
    make down
    ```

### Запуск в продакшене
В этом режиме дополнительно запускаются `nginx` для обратного проксирования и `certbot` для автоматического получения и обновления SSL-сертификатов.

1.  **Сборка и запуск контейнеров:**
    Для сборки и запуска всех сервисов в продакшен-режиме выполните:
    ```bash
    make up
    ```
    Эта команда использует файлы `docker-compose.yml` и `docker-compose.prod.yml` для создания полной продакшен-среды. Контейнеры будут запущены в фоновом режиме.

2.  **Пример запуска через командную строку:**
    Если вы хотите запустить проект без использования `Makefile`, вы можете выполнить следующую команду напрямую:
    ```bash
    docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
    ```

3.  **Остановка контейнеров:**
    Для остановки всех сервисов, запущенных в продакшен-режиме, используйте:
    ```bash
    make down
    ```
    Или, если требуются права суперпользователя:
    ```bash
    make down-tot
    ```
## Доступные команды Makefile
В `Makefile` определены следующие команды для удобства управления проектом:

-   `make help`: Показывает все доступные команды.
-   `make up`: Собирает и запускает все продакшен-сервисы в фоновом режиме.
-   `make down`: Останавливает все сервисы.
-   `make up-at`: Собирает и запускает все продакшен-сервисы в интерактивном режиме (полезно для отладки).
-   `make up-dev`: Запускает сервисы для локальной разработки.
-   `make down-tot`: Останавливает все сервисы с правами суперпользователя.